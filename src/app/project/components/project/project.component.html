<div class="d-flex flex-column">
    <div class="bottom-panel d-flex justify-content-between align-items-center">
        <div class="px-3 d-flex justify-content-start align-items-center">
            <div [routerLink]="['/']" routerLinkActive="router-link-active">
                <app-logo></app-logo>
            </div>
            <div
                class="d-flex justify-content-center align-items-center ms-5 me-3 clickable ic-hover"
                (click)="toggleComments()"
            >
                <i class="ph ph-chat-circle fs-4 me-1"></i>
                <span>
                    {{ projectData?.project?.commentCount || 0 }}
                </span>
            </div>
            <div
                class="d-flex justify-content-center align-items-center clickable ic-hover"
                (click)="toggleImages()"
            >
                <i class="ph ph-image fs-4"></i>
            </div>
            <!-- <div class="mx-3 clickable" (click)="openSetting()">
        <span class="material-icons ic-hover" [style.fontSize.px]="24">
          settings
        </span>
      </div> -->
        </div>
        <div class="px-3 d-flex justify-content-start"></div>
        <div class="px-3 d-flex justify-content-end">
            <div class="mx-3">
                <button
                    mat-flat-button
                    class="flex-fill btn-primary d-flex justify-content-center align-items-center"
                    (click)="openShare()"
                >
                    <span class="me-2">
                        <i class="ph ph-share-fat fs-6 pe-1"></i>
                    </span>
                    <span>Share</span>
                </button>
            </div>
        </div>
    </div>
    <div class="d-flex flex-row">
        <div class="image-sidebar" *ngIf="showImageSidebar">
            <div class="mt-3 d-flex flex-row justify-content-center">
                <app-file-chooser
                    [projectKey]="projectKey"
                    [labelTemplateRef]="newLabel"
                    [showFooter]="false"
                    [addAsActive]="false"
                ></app-file-chooser>
            </div>
            <div
                *ngFor="let img of projectData.uploads; index as i"
                class="p-3"
            >
                <div
                    [id]="img.key"
                    class="editable d-flex align-items-center img-name"
                >
                    <span
                        contenteditable="true"
                        (blur)="onEditableBlur($event, img.key, i)"
                        (keyup)="onEditableKeyup($event, img.key, i)"
                        class="editable-name"
                    >
                        {{ img.name }}
                    </span>
                    <span class="edit-name-icon">
                        <i class="ph ph-pencil-simple"></i>
                    </span>

                    <span *ngIf="img.isLoading" class="ms-2 upload-spinner">
                        <mat-spinner
                            [diameter]="16"
                            strokeWidth="1"
                        ></mat-spinner>
                    </span>
                </div>

                <div
                    class="image-container"
                    [ngClass]="{
                        selected: img.key === projectData?.selectedImg?.key
                    }"
                    (click)="changeImg(img, i)"
                >
                    <img class="image-sb" [src]="img.url" />
                    <div class="hover-overlay p-1">
                        <span
                            class="hover-icons"
                            (click)="confirmDeleteImg(img)"
                        >
                            <i class="ph ph-trash-simple"></i>
                        </span>
                        <label
                            [for]="'replaceImg' + i"
                            class="image-label hover-icons"
                        >
                            <span class="hover-icons">
                                <i
                                    class="ph-bold ph-arrow-bend-down-left pe-1"
                                ></i>
                            </span>
                        </label>
                        <input
                            [id]="'replaceImg' + i"
                            type="file"
                            accept="image/bmp,image/gif,image/jpeg,image/png,image/svg+xml"
                            (change)="replaceImg($event, img)"
                            hidden
                        />
                    </div>
                </div>
            </div>
        </div>
        <div class="canvas" [ngStyle]="{ width: canvasAreaWidth }">
            <div class="d-flex flex-column">
                <div class="sidebar-toggle">
                    <button class="btn-toggle" (click)="toggleComments()">
                        <span class="sidebar-toggle-icon">
                            <i
                                *ngIf="showCommentSidebar"
                                class="ph-bold ph-caret-right fs-5"
                            ></i>
                            <i
                                *ngIf="!showCommentSidebar"
                                class="ph-bold ph-caret-left fs-5"
                            ></i>
                        </span>
                    </button>
                </div>
                <div
                    class="image-header px-3 d-flex flex-row justify-content-between align-items-center"
                >
                    <div
                        class="d-flex flex-row justify-content-start align-items-center"
                        [ngStyle]="{ width: headerTextArea }"
                    >
                        <span class="px-2 text-ellipsis">
                            {{ projectData?.selectedImg?.name }}
                        </span>
                        <!-- <span class="px-2">{{ projectData?.selectedImg?.extension }}</span> -->
                        <span class="px-2">
                            {{ projectData?.selectedImg?.size | bytes2string }}
                        </span>
                    </div>
                    <div
                        class="header-middle d-flex flex-row justify-content-center align-items-center"
                    >
                        <i
                            class="ph ph-arrow-left fs-5 nav-icons"
                            (click)="prevImg()"
                        ></i>
                        <span>
                            {{ projectData?.imgIndex + 1 }}&nbsp;of&nbsp;{{
                                projectData?.uploads?.length
                            }}
                        </span>
                        <i
                            class="ph ph-arrow-right fs-5 nav-icons"
                            (click)="nextImg()"
                        ></i>
                    </div>
                    <a
                        [href]="projectData?.selectedImg?.url"
                        [download]="projectData?.selectedImg?.name"
                        target="_blank"
                    >
                        <i
                            class="ph-bold ph-download-simple nav-icons fs-5"
                        ></i>
                    </a>
                </div>
                <div class="canvas-container" (resized)="onResized()">
                    <app-quill-editor
                        [data]="editorData"
                        *ngIf="showEditor || showCreateEditor"
                        (selectionChanged)="onClose($event)"
                    ></app-quill-editor>
                    <div
                        class="markup-pin d-flex justify-content-center align-items-center"
                        [style.top.px]="editorData.y - 15"
                        [style.left.px]="editorData.x - 15"
                        *ngIf="showCreateEditor"
                    >
                        <span class="markup-pin-content"></span>
                    </div>
                    <div
                        *ngFor="let pin of projectData?.currentComments"
                        class="markup-pin d-flex justify-content-center align-items-center"
                        [attr.data-markup-id]="pin.key"
                        [style.top.px]="pin.pinY * hMultipler - 15"
                        [style.left.px]="pin.pinX * wMultipler - 15"
                        [ngClass]="{ 'resolved-pin': pin.status == 2 }"
                        (click)="openPin(pin)"
                    >
                        <span class="markup-pin-content">{{ pin.index }}</span>
                    </div>
                    <img
                        #canvasDiv
                        class="canvas-image"
                        [src]="projectData?.selectedImg?.url"
                    />
                </div>
            </div>
        </div>
        <div class="comment-sidebar" *ngIf="showCommentSidebar">
            <div class="m-3">
                <div>
                    <!-- class="mx-3" -->
                    <!-- <mat-button-toggle-group [(ngModel)]="sidebarDisplay" [style.width]="'100%'">
                    <mat-button-toggle value="active" [style.width]="'50%'" (click)="toggle('active')">Active
                    </mat-button-toggle>
                    <mat-button-toggle value="resolved" [style.width]="'50%'" (click)="toggle('resolved')">Resolved
                    </mat-button-toggle>
                </mat-button-toggle-group> -->

                    <mat-tab-group
                        [disablePagination]="true"
                        animationDuration="0ms"
                    >
                        <mat-tab label="Active">
                            <!-- <ng-container [ngTemplateOutlet]="active">
                        </ng-container> -->
                            <ng-template matTabContent #active>
                                <!-- <div *ngIf="sidebarDisplay == 'active'"> -->
                                <div
                                    class="px-2"
                                    [ngClass]="{ hide: panelData?.inViewMode }"
                                >
                                    <div
                                        *ngFor="
                                            let file of panelData?.files;
                                            index as i
                                        "
                                        class="my-3"
                                    >
                                        <div
                                            *ngIf="
                                                file?.activeComments?.length > 0
                                            "
                                        >
                                            <div
                                                (click)="changeCollapsible(i)"
                                                [ngClass]="{
                                                    'tab-selected':
                                                        !file.isCollapsed
                                                }"
                                                class="tab d-flex flex-row align-items-center"
                                            >
                                                <span class="text-ellipsis">
                                                    {{ i + 1 }}.&nbsp;{{
                                                        file.name
                                                    }}
                                                </span>
                                                <div
                                                    class="collapse-icon com-count d-flex justify-content-center align-items-center"
                                                    [ngClass]="{
                                                        selected:
                                                            !file.isCollapsed
                                                    }"
                                                >
                                                    <span>
                                                        {{
                                                            file?.activeComments
                                                                ?.length || 0
                                                        }}
                                                    </span>
                                                </div>
                                            </div>
                                            <div
                                                #collapse="ngbCollapse"
                                                [animation]="false"
                                                [(ngbCollapse)]="
                                                    file.isCollapsed
                                                "
                                                class="my-2"
                                            >
                                                <div
                                                    *ngFor="
                                                        let comment of file?.activeComments;
                                                        index as i
                                                    "
                                                    class="my-3 msg-card view"
                                                >
                                                    <div
                                                        (click)="
                                                            viewComment(comment)
                                                        "
                                                    >
                                                        <div
                                                            class="view-pin d-flex justify-content-center align-items-center"
                                                            [style.right.px]="
                                                                10
                                                            "
                                                            (click)="
                                                                onPinClick(
                                                                    $event,
                                                                    comment
                                                                )
                                                            "
                                                        >
                                                            <span>
                                                                {{
                                                                    comment.index
                                                                }}
                                                            </span>
                                                        </div>
                                                        <span class="name">
                                                            {{
                                                                comment.displayName
                                                            }}
                                                        </span>
                                                        <app-new-tag
                                                            *ngIf="
                                                                checkNewTag(
                                                                    comment
                                                                )
                                                            "
                                                        ></app-new-tag>
                                                        <div
                                                            class="time-ago-text"
                                                        >
                                                            {{
                                                                comment.updatedAt
                                                                    | timeago
                                                            }}
                                                            <span
                                                                *ngIf="
                                                                    comment.updatedBy !=
                                                                    ''
                                                                "
                                                            >
                                                                (edited)
                                                            </span>
                                                        </div>
                                                        <app-quill-viewer
                                                            [content]="
                                                                comment.content
                                                            "
                                                        ></app-quill-viewer>
                                                    </div>
                                                    <div
                                                        class="msg-card-footer d-flex justify-content-start align-items-center"
                                                    >
                                                        <div
                                                            [style.marginTop.px]="
                                                                5
                                                            "
                                                        >
                                                            <div
                                                                *ngIf="
                                                                    comment
                                                                        ?.children
                                                                        ?.length >
                                                                    0
                                                                "
                                                                class="child-container"
                                                            >
                                                                <span
                                                                    class="d-flex justify-content-center align-items-center font-dark-gray"
                                                                >
                                                                    <i
                                                                        class="ph ph-chat-circle pe-1 fs-6"
                                                                    ></i>
                                                                    {{
                                                                        comment
                                                                            ?.children
                                                                            ?.length ||
                                                                            0
                                                                    }}
                                                                </span>
                                                            </div>
                                                            <div
                                                                class="footer-container"
                                                            >
                                                                <span
                                                                    class="btn-resolve d-flex justify-content-center align-items-center"
                                                                    (click)="
                                                                        resolveComment(
                                                                            comment
                                                                        )
                                                                    "
                                                                >
                                                                    <i
                                                                        class="ph ph-check pe-1"
                                                                    ></i>
                                                                    Resolve
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- </div> -->
                            </ng-template>
                        </mat-tab>
                        <mat-tab label="Resolved">
                            <!-- <ng-container [ngTemplateOutlet]="resolved">
                        </ng-container> -->
                            <ng-template matTabContent #resolved>
                                <!-- <div *ngIf="sidebarDisplay == 'resolved'"> -->
                                <div
                                    class="px-2"
                                    [ngClass]="{ hide: panelData?.inViewMode }"
                                >
                                    <div
                                        *ngFor="
                                            let file of panelData?.files;
                                            index as i
                                        "
                                        class="my-3"
                                    >
                                        <div
                                            *ngIf="
                                                file?.resolvedComments?.length >
                                                0
                                            "
                                        >
                                            <div
                                                (click)="changeCollapsible(i)"
                                                [ngClass]="{
                                                    'tab-selected':
                                                        !file.isCollapsed
                                                }"
                                                class="tab d-flex flex-row align-items-center"
                                            >
                                                <span class="text-ellipsis">
                                                    {{ i + 1 }}.&nbsp;{{
                                                        file.name
                                                    }}
                                                </span>
                                                <div
                                                    class="collapse-icon com-count d-flex justify-content-center align-items-center"
                                                    [ngClass]="{
                                                        selected:
                                                            !file.isCollapsed
                                                    }"
                                                >
                                                    <span>
                                                        {{
                                                            file
                                                                ?.resolvedComments
                                                                ?.length || 0
                                                        }}
                                                    </span>
                                                </div>
                                            </div>
                                            <div
                                                #collapse="ngbCollapse"
                                                [animation]="false"
                                                [(ngbCollapse)]="
                                                    file.isCollapsed
                                                "
                                                class="my-2"
                                            >
                                                <div
                                                    *ngFor="
                                                        let comment of file?.resolvedComments;
                                                        index as i
                                                    "
                                                    class="my-3 msg-card view"
                                                >
                                                    <div
                                                        (click)="
                                                            viewComment(comment)
                                                        "
                                                    >
                                                        <div
                                                            class="view-pin resolved-pin d-flex justify-content-center align-items-center"
                                                            [style.right.px]="
                                                                10
                                                            "
                                                            (click)="
                                                                onPinClick(
                                                                    $event,
                                                                    comment
                                                                )
                                                            "
                                                        >
                                                            <span>
                                                                {{
                                                                    comment.index
                                                                }}
                                                            </span>
                                                        </div>
                                                        <span class="name">
                                                            {{
                                                                comment.displayName
                                                            }}
                                                        </span>
                                                        <app-new-tag
                                                            *ngIf="
                                                                checkNewTag(
                                                                    comment
                                                                )
                                                            "
                                                        ></app-new-tag>
                                                        <div
                                                            class="time-ago-text"
                                                        >
                                                            {{
                                                                comment.updatedAt
                                                                    | timeago
                                                            }}
                                                        </div>
                                                        <app-quill-viewer
                                                            [content]="
                                                                comment.content
                                                            "
                                                        ></app-quill-viewer>
                                                    </div>
                                                    <div
                                                        class="msg-card-footer d-flex justify-content-start align-items-center"
                                                    >
                                                        <div
                                                            class="footer-container"
                                                        >
                                                            <span
                                                                class="btn-unresolve d-flex justify-content-center align-items-center"
                                                                (click)="
                                                                    unresolveComment(
                                                                        comment
                                                                    )
                                                                "
                                                            >
                                                                <i
                                                                    class="ph ph-x pe-1"
                                                                ></i>
                                                                Unresolve
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- </div> -->
                            </ng-template>
                        </mat-tab>
                    </mat-tab-group>
                </div>
            </div>
            <div
                class="m-3 px-2"
                [ngClass]="{ hide: panelData?.inViewMode === false }"
            >
                <div class="d-flex justify-content-between align-items-center">
                    <span
                        class="btn-back d-flex justify-content-center align-items-center"
                        (click)="goBack()"
                    >
                        <i class="ph ph-arrow-left pe-1"></i>
                        Back
                    </span>
                    <span
                        *ngIf="panelData?.comment2edit?.status == 1"
                        class="btn-resolve d-flex justify-content-center align-items-center"
                        (click)="resolveComment(panelData?.comment2edit)"
                    >
                        <i class="ph ph-check pe-1"></i>
                        Resolve
                    </span>
                    <span
                        *ngIf="panelData?.comment2edit?.status == 2"
                        class="btn-unresolve d-flex justify-content-center align-items-center"
                        (click)="unresolveComment(panelData?.comment2edit)"
                    >
                        <i class="ph ph-x pe-1"></i>
                        Unresolve
                    </span>
                </div>
                <div
                    *ngIf="panelData.comment2edit != null"
                    class="my-3 boxShadow"
                >
                    <div class="msg-card new-comment">
                        <div
                            class="view-pin d-flex justify-content-center align-items-center"
                            [style.right.px]="10"
                            (click)="onPinClick($event, panelData.comment2edit)"
                        >
                            <span>{{ panelData?.comment2edit?.index }}</span>
                        </div>
                        <span class="name">
                            {{ panelData?.comment2edit?.displayName }}
                        </span>
                        <div class="time-ago-text">
                            {{ panelData?.comment2edit?.updatedAt | timeago }}
                        </div>
                        <div *ngIf="panelData?.isEdit == false">
                            <app-quill-viewer
                                [content]="panelData?.comment2edit?.content"
                            ></app-quill-viewer>
                        </div>
                        <div *ngIf="panelData?.isEdit">
                            <app-editor
                                [data]="panelData?.comment2edit"
                                (selectionChanged)="closeEditComment($event)"
                            ></app-editor>
                        </div>
                        <div *ngIf="panelData?.comment2edit?.status == 1">
                            <div
                                *ngIf="panelData?.isEdit == false"
                                class="d-flex justify-content-start align-items-center"
                            >
                                <span
                                    *ngIf="
                                        panelData?.comment2edit?.createdBy ==
                                        currentUserKey
                                    "
                                    class="comment-box-action"
                                    (click)="openEditComment()"
                                >
                                    <i class="ph ph-pencil-simple"></i>
                                </span>
                                <span
                                    class="comment-box-action"
                                    (click)="
                                        confirmDelete(panelData?.comment2edit)
                                    "
                                >
                                    <i class="ph ph-trash"></i>
                                </span>
                            </div>
                            <div
                                class="confirm-delete"
                                *ngIf="
                                    panelData?.comment2edit?.confirmDelete ===
                                    true
                                "
                            >
                                <div
                                    class="d-flex flex-column flex-row justify-content-center align-items-center"
                                    [style.height]="'100%'"
                                >
                                    <span>Delete comment?</span>
                                    <span class="confirm-delete-msg">
                                        This will also delete any replies to the
                                        comment.
                                    </span>
                                    <div>
                                        <span
                                            class="confirm-delete-icon"
                                            (click)="
                                                deleteComment(
                                                    panelData?.comment2edit
                                                )
                                            "
                                        >
                                            <i class="ph ph-check-fat"></i>
                                        </span>
                                        <span
                                            class="cancel-delete-icon ms-2"
                                            (click)="
                                                closeDelete(
                                                    panelData?.comment2edit
                                                )
                                            "
                                        >
                                            <i class="ph ph-x"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        class="children"
                        *ngIf="panelData?.comment2edit?.children?.length > 0"
                    >
                        <div
                            *ngFor="
                                let child of panelData.comment2edit.children;
                                last as isLast;
                                index as i
                            "
                        >
                            <div
                                class="child-comment-container d-flex flex-row"
                            >
                                <div
                                    class="d-flex flex-column align-items-center timeline-dots"
                                >
                                    <span
                                        *ngFor="let item of [].constructor(3)"
                                        class="small-dot"
                                    >
                                        <i class="ph ph-dot"></i>
                                    </span>
                                    <span class="big-dot">
                                        <i class="ph ph-dot-outline"></i>
                                    </span>
                                    <span
                                        *ngIf="!isLast"
                                        class="d-flex flex-column align-items-center"
                                    >
                                        <span
                                            *ngFor="
                                                let item of [].constructor(
                                                    child.isEdit ? 38 : 18
                                                )
                                            "
                                            class="small-dot"
                                        >
                                            <i class="ph ph-dot"></i>
                                        </span>
                                    </span>
                                </div>
                                <div class="content-card">
                                    <span class="name">
                                        {{ child.displayName }}
                                    </span>
                                    <app-new-tag
                                        *ngIf="checkNewTag(child)"
                                    ></app-new-tag>
                                    <div class="time-ago-text">
                                        {{ child.updatedAt | timeago }}
                                    </div>
                                    <div *ngIf="child?.isEdit == false">
                                        <app-quill-viewer
                                            [content]="child?.content"
                                        ></app-quill-viewer>
                                    </div>
                                    <div *ngIf="child?.isEdit">
                                        <app-editor
                                            [data]="child"
                                            (selectionChanged)="
                                                closeEditChildComment(
                                                    $event,
                                                    child
                                                )
                                            "
                                        ></app-editor>
                                    </div>
                                    <!-- condition to check if parent comment is resolved or not as child comments are never in resolved state -->
                                    <div
                                        *ngIf="
                                            child?.status == 1 &&
                                            panelData?.comment2edit?.status == 1
                                        "
                                    >
                                        <div
                                            *ngIf="child?.isEdit == false"
                                            class="d-flex justify-content-start align-items-center"
                                        >
                                            <span
                                                *ngIf="
                                                    child?.createdBy ==
                                                    currentUserKey
                                                "
                                                class="comment-box-action"
                                                (click)="
                                                    openEditChildComment(child)
                                                "
                                            >
                                                <i
                                                    class="ph ph-pencil-simple"
                                                ></i>
                                            </span>
                                            <span
                                                class="comment-box-action"
                                                (click)="confirmDelete(child)"
                                            >
                                                <i class="ph ph-trash"></i>
                                            </span>
                                        </div>
                                        <div
                                            class="confirm-delete"
                                            *ngIf="
                                                child?.confirmDelete === true
                                            "
                                        >
                                            <div
                                                class="d-flex flex-column flex-row justify-content-center align-items-center"
                                                [style.height]="'100%'"
                                            >
                                                <p>Delete message?</p>
                                                <div>
                                                    <span
                                                        class="confirm-delete-icon"
                                                        (click)="
                                                            deleteComment(
                                                                child,
                                                                true
                                                            )
                                                        "
                                                    >
                                                        <i
                                                            class="ph ph-check-fat"
                                                        ></i>
                                                    </span>
                                                    <span
                                                        class="cancel-delete-icon ms-2"
                                                        (click)="
                                                            closeDelete(child)
                                                        "
                                                    >
                                                        <i class="ph ph-x"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        *ngIf="panelData?.comment2edit?.status == 1"
                        class="add-comment-section"
                    >
                        <app-editor
                            [data]="panelData?.newComment"
                            [className]="'add-comment-container'"
                            [showCancel]="false"
                        >
                            <!-- (selectionChanged)="clearNewComment($event)" -->
                        </app-editor>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #content let-modal>
    <div class="modal-header d-flex justify-content-end">
        <div class="close" role="button" (click)="closeConfirmModal()">
            <span class="modal-close">&times;</span>
        </div>
    </div>
    <div class="modal-body mb-3">
        <div
            class="d-flex flex-column justify-content-center align-items-center delete-modal"
        >
            <p>Delete {{ projectData?.deleteImg?.name }}</p>
            <p
                class="confirm-delete-icon"
                [style.fontSize.px]="12"
                [style.fontWeight]="500"
            >
                Warning, this cannot be undone.
            </p>
            <p [style.fontSize.px]="14">All comments will be deleted.</p>
            <span
                class="btn-danger d-flex justify-content-center align-items-center min-btn"
                (click)="deleteImg()"
            >
                Delete
            </span>
        </div>
    </div>
</ng-template>

<ng-template #newLabel>
    <span class="px-3 btn-primary d-flex align-items-center btn-rounded">
        <i class="ph ph-plus pe-1"></i>
        <span [style.fontSize.px]="14">New</span>
    </span>
</ng-template>

<!-- <ng-template #settings let-modal>
  <div class="modal-body">
    <div class="form-check form-check-inline">
      <input
        class="form-check-input"
        type="checkbox"
        id="emailLabel"
        [checked]="projectData.project.sendEmail"
        (click)="settingsChange('sendEmail')"
      />
      <label class="form-check-label" for="emailLabel"
        >Send email notifications</label
      >
    </div>
  </div>
</ng-template> -->

<ng-template #share let-modal>
    <div class="modal-body">
        <div class="d-flex justify-content-end mb-3">
            <div class="close" role="button" (click)="closeShare()">
                <span class="modal-close">&times;</span>
            </div>
        </div>
        <div class="mx-5">
            <div class="d-flex justify-content-center">
                <h5>Invite people to this project</h5>
            </div>
            <form [formGroup]="shareForm">
                <div class="error-message">
                    <div
                        *ngIf="shareSubmitted && _shareForm.email.errors"
                        class="invalid-message"
                    >
                        <span *ngIf="_shareForm.email.errors.required">
                            Email is required!
                        </span>
                        <span *ngIf="_shareForm.email.errors.multipleEmail">
                            Please enter valid email!
                        </span>
                    </div>
                    <ngb-toast
                        *ngIf="shareError"
                        [autohide]="false"
                        class="share-toast"
                    >
                        <div
                            class="d-flex justify-content-between align-items-start"
                        >
                            <span>Try again!</span>
                            <span
                                aria-hidden="true"
                                (click)="shareError = false"
                                class="clickable"
                            >
                                &times;
                            </span>
                        </div>
                    </ngb-toast>
                </div>
                <div
                    class="my-3 d-flex justify-content-center align-items-center"
                >
                    <div class="flex-fill">
                        <mat-form-field class="multiple-email-wrapper w-100">
                            <mat-chip-list
                                #chipList
                                multiple
                                formControlName="email"
                            >
                                <mat-chip
                                    *ngFor="
                                        let email of _shareForm.email.value;
                                        index as i
                                    "
                                    [selectable]="shareChipsProps.selectable"
                                    [removable]="shareChipsProps.removable"
                                    (removed)="removeEmail(i)"
                                    class="d-flex justify-content-center align-content-center"
                                >
                                    {{ email }}
                                    <i
                                        matChipRemove
                                        class="ph-fill ph-x-circle fs-5"
                                        *ngIf="shareChipsProps.removable"
                                    ></i>
                                </mat-chip>
                                <input
                                    placeholder="Enter an email address"
                                    [matChipInputFor]="chipList"
                                    [matChipInputSeparatorKeyCodes]="
                                        shareChipsProps.separatorKeysCodes
                                    "
                                    [matChipInputAddOnBlur]="
                                        shareChipsProps.addOnBlur
                                    "
                                    (matChipInputTokenEnd)="addEmail($event)"
                                />
                            </mat-chip-list>
                        </mat-form-field>
                    </div>
                    <button
                        id="share-btn"
                        mat-flat-button
                        [disabled]="isLoading"
                        (click)="handleShare()"
                        class="ms-3 px-3 btn-primary d-flex justify-content-center align-items-center btn-rounded min-btn"
                    >
                        Share
                    </button>
                </div>
            </form>

            <div>
                <h6>Members</h6>
                <mat-chip-list #chipList>
                    <mat-chip
                        disabled
                        *ngFor="let email of projectUsers; index as i"
                        class="d-flex justify-content-center align-content-center"
                    >
                        {{ email }}
                    </mat-chip>
                </mat-chip-list>
            </div>

            <div class="mt-4 mb-2">
                <h6>Your project invite link</h6>
                <div
                    class="d-flex justify-content-center align-items-center share-invite py-2 px-3"
                >
                    <div class="flex-fill text-truncate">
                        {{ _shareForm.link.value }}
                    </div>
                    <i
                        class="ph-fill ph-copy-simple copy-btn"
                        (click)="copyLink()"
                    ></i>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #guest let-modal>
    <div class="modal-body">
        <div class="d-flex justify-content-end mb-3">
            <div class="close" role="button" (click)="closeGuest()">
                <span class="modal-close">&times;</span>
            </div>
        </div>
        <section class="d-flex flex-column justify-content-between">
            <div class="flex-grow-0">
                <app-logo></app-logo>
                <p class="mt-3">
                    No signup required. Just provide a little info to let your
                    team know who the feedback is from.
                </p>
            </div>
            <form [formGroup]="guestForm" class="w-100">
                <div class="form-group">
                    <mat-form-field
                        class="auth-form w-100"
                        [floatLabel]="floatLabelControl.value"
                    >
                        <mat-label>Name</mat-label>
                        <input
                            matInput
                            required
                            placeholder=""
                            formControlName="name"
                            [ngClass]="{
                                'is-invalid':
                                    isGuestSubmitted && _guestForm.name.errors
                            }"
                        />
                    </mat-form-field>
                </div>
                <div id="guest-msg" class="mt-2 flex-grow-1 auth-message">
                    <div *ngIf="isGuestSubmitted">
                        <span *ngIf="_guestForm?.name?.errors?.required">
                            Name is required.
                        </span>
                    </div>
                </div>
                <div
                    class="d-flex flex-column justify-content-start align-items-center"
                >
                    <button
                        mat-flat-button
                        class="w-100 btn-primary"
                        [disabled]="isLoading"
                        (click)="continueGuest()"
                    >
                        Continue as guest
                    </button>
                    <span class="my-3">or sign up for free</span>
                    <button
                        mat-flat-button
                        class="w-100 btn-primary"
                        [disabled]="isLoading"
                        (click)="moveToAuth('signup')"
                    >
                        Sign up
                    </button>
                </div>
            </form>
            <div class="mt-3 font-light-gray" [style.fontSize.px]="12">
                Already have a MarkUp account?
                <span id="signin" (click)="moveToAuth()">Sign In</span>
            </div>
        </section>
    </div>
</ng-template>
